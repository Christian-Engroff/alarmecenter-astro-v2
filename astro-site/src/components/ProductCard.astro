---
export interface Props {
  product: {
    id: string;
    name: string;
    slug: string;
    description?: string;
    price: string;
    regularPrice?: string;
    salePrice?: string;
    image: {
      sourceUrl: string;
      altText: string;
    };
    productCategories: {
      nodes: Array<{
        name: string;
        slug: string;
      }>;
    };
  };
}

const { product } = Astro.props;
const hasDiscount = product.salePrice && product.regularPrice && product.salePrice !== product.regularPrice;
---

<div class="product-card bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border border-gray-200">
  <!-- Product Image -->
  <div class="relative overflow-hidden rounded-t-lg group">
    <a href={`/produto/${product.slug}`} class="block">
      <img 
        src={product.image.sourceUrl || '/placeholder-product.jpg'} 
        alt={product.image.altText || product.name}
        class="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    </a>
    
    <!-- Discount Badge -->
    {hasDiscount && (
      <div class="absolute top-3 left-3 bg-red-500 text-white px-2 py-1 rounded text-sm font-semibold">
        OFERTA
      </div>
    )}
    
    <!-- Quick Actions -->
    <div class="absolute top-3 right-3 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
      <button 
        class="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors"
        title="Adicionar aos favoritos"
        onclick="addToWishlist('{product.id}')"
      >
        ‚ù§Ô∏è
      </button>
      <button 
        class="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors"
        title="Visualiza√ß√£o r√°pida"
        onclick="quickView('{product.id}')"
      >
        üëÅÔ∏è
      </button>
    </div>
  </div>

  <!-- Product Info -->
  <div class="p-4 space-y-3">
    <!-- Category -->
    {product.productCategories.nodes.length > 0 && (
      <div class="flex flex-wrap gap-1">
        {product.productCategories.nodes.slice(0, 2).map(category => (
          <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
            {category.name}
          </span>
        ))}
      </div>
    )}

    <!-- Product Title -->
    <h3 class="product-title font-semibold text-gray-800 line-clamp-2 leading-tight">
      <a href={`/produto/${product.slug}`} class="hover:text-red-600 transition-colors">
        {product.name}
      </a>
    </h3>

    <!-- Rating (Mock) -->
    <div class="flex items-center space-x-2">
      <div class="flex text-yellow-400 text-sm">
        ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
      </div>
      <span class="text-gray-500 text-sm">(0)</span>
    </div>

    <!-- Price -->
    <div class="price-section space-y-1">
      {hasDiscount ? (
        <div class="space-y-1">
          <div class="text-sm text-gray-500 line-through">
            {product.regularPrice}
          </div>
          <div class="text-xl font-bold text-red-600">
            {product.salePrice}
          </div>
        </div>
      ) : (
        <div class="text-xl font-bold text-red-600">
          {product.price}
        </div>
      )}
    </div>

    <!-- SKU -->
    <div class="text-xs text-gray-400">
      SKU: {product.id}
    </div>

    <!-- Action Buttons -->
    <div class="space-y-2 pt-2">
      <button 
        class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors"
        onclick="addToCart('{product.id}')"
      >
        Adicionar ao Carrinho
      </button>
      
      <div class="flex space-x-2">
        <button 
          class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors"
          onclick="buyNow('{product.id}')"
        >
          Comprar Agora
        </button>
        <button 
          class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors"
        >
          <a href={`/produto/${product.slug}`}>Ver Detalhes</a>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Global functions for product interactions
  window.addToCart = function(productId) {
    console.log('Adding to cart:', productId);
    // TODO: Implement cart functionality
    alert('Produto adicionado ao carrinho!');
  };

  window.addToWishlist = function(productId) {
    console.log('Adding to wishlist:', productId);
    // TODO: Implement wishlist functionality
    alert('Produto adicionado aos favoritos!');
  };

  window.quickView = function(productId) {
    console.log('Quick view:', productId);
    // TODO: Implement quick view modal  
    alert('Visualiza√ß√£o r√°pida em desenvolvimento');
  };

  window.buyNow = function(productId) {
    console.log('Buy now:', productId);
    // TODO: Implement direct purchase
    alert('Compra direta em desenvolvimento');
  };
</script>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>